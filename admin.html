<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="img/setting.png" rel="icon">
    <title>Dashboard - Ami & Ade</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            bg: '#0f172a',
                            card: '#1e293b',
                            border: '#334155'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap');
        body { font-family: 'Montserrat', sans-serif; transition: background-color 0.3s ease, color 0.3s ease; }
        #auth-section, #admin-section, #settings-view, #generator-view, #sql-view, #preview-view { display: none; }
        
        /* Background Login Responsif dengan Overlay 70% */
        #auth-section {
            background: linear-gradient(rgba(15, 23, 42, 0.7), rgba(15, 23, 42, 0.7)), 
                        url('img/bubududu1.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        /* Efek Glassmorphism untuk Card Login dengan Transparansi 70% */
        .auth-card {
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            background-color: rgba(255, 255, 255, 0.7);
        }
        .dark .auth-card {
            background-color: rgba(30, 41, 59, 0.7);
        }

        .tab-active {
            color: #2563eb;
            border-bottom: 2px solid #2563eb;
        }
        .dark .tab-active {
            color: #60a5fa;
            border-bottom-color: #60a5fa;
        }

        .wa-preview-container {
            background-color: #e5ddd5;
            background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png');
            background-blend-mode: overlay;
            transition: filter 0.3s ease;
        }
        .dark .wa-preview-container {
            background-color: #0b141a;
            filter: brightness(0.8);
        }
        .wa-chat-bubble {
            background: #ffffff;
            color: #111b21;
            padding: 12px 15px;
            border-radius: 8px 8px 8px 0;
            font-size: 0.9rem;
            line-height: 1.5;
            position: relative;
            box-shadow: 0 1px 0.5px rgba(0,0,0,0.13);
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .dark .wa-chat-bubble {
            background: #202c33;
            color: #e9edef;
        }
        .wa-chat-bubble::before {
            content: "";
            position: absolute;
            bottom: 0;
            left: -10px;
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 0 10px 10px 0;
            border-color: transparent #ffffff transparent transparent;
        }
        .dark .wa-chat-bubble::before {
            border-color: transparent #202c33 transparent transparent;
        }

        /* Phone Frame Preview */
        .phone-frame {
            width: 360px;
            height: 640px;
            border: 12px solid #1e293b;
            border-radius: 32px;
            overflow: hidden;
            position: relative;
            background: white;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            margin: 0 auto;
        }
        @media (max-width: 400px) {
            .phone-frame {
                width: 100%;
                height: 500px;
                border-width: 8px;
            }
        }

        /* Custom Dropdown Styling */
        .bank-dropdown-list {
            display: none;
            position: absolute;
            width: 100%;
            z-index: 50;
            top: 100%;
            left: 0;
            margin-top: 5px;
            max-height: 250px;
            overflow-y: auto;
        }
        .bank-dropdown-list.show { display: block; }

        /* Auto-hide Navigation Style */
        #main-nav {
            transition: transform 0.3s ease-in-out;
        }
        .nav-hidden {
            transform: translateY(-100%);
        }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-900 min-h-screen text-slate-800 dark:text-slate-200">

    <!-- LOGIN SECTION -->
    <div id="auth-section" class="flex items-center justify-center min-h-screen p-4">
            <form id="login-form" class="space-y-5">
                <div>
                    <label class="block text-[10px] font-bold text-slate-700 dark:text-slate-300 uppercase mb-2 tracking-wider">Email</label>
                    <input type="email" id="email" required class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-600 focus:ring-2 focus:ring-blue-500 outline-none bg-white/50 dark:bg-slate-900/50 dark:text-white transition-all" placeholder="admin@email.com">
                </div>
                <div>
                    <label class="block text-[10px] font-bold text-slate-700 dark:text-slate-300 uppercase mb-2 tracking-wider">Password</label>
                    <input type="password" id="password" required class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-600 focus:ring-2 focus:ring-blue-500 outline-none bg-white/50 dark:bg-slate-900/50 dark:text-white transition-all" placeholder="••••••••">
                </div>
                <button type="submit" id="login-btn" class="w-full bg-blue-600 text-white py-4 rounded-xl font-bold hover:bg-blue-700 shadow-lg transition-all active:scale-95">
                    Masuk
                </button>
            </form>
        </div>
    </div>

    <!-- ADMIN DASHBOARD SECTION -->
    <div id="admin-section">
        <nav id="main-nav" class="bg-white dark:bg-slate-800 border-b dark:border-slate-700 sticky top-0 z-50 shadow-sm">
            <div class="container mx-auto px-6 py-4 flex justify-between items-center">
                <div class="flex items-center gap-6">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center text-white shadow-md">
                            <i class="fa-solid fa-database"></i>
                        </div>
                        <h2 class="font-bold text-lg text-slate-800 dark:text-white hidden lg:block">Dashboard</h2>
                    </div>
                    <div class="flex gap-4">
                        <button onclick="switchView('rsvp')" id="nav-rsvp" class="tab-active font-bold pb-1 text-xs md:text-sm">Tamu</button>
                        <button onclick="switchView('settings')" id="nav-settings" class="text-slate-400 font-bold pb-1 text-xs md:text-sm">Pengaturan</button>
                        <button onclick="switchView('generator')" id="nav-generator" class="text-slate-400 font-bold pb-1 text-xs md:text-sm">Generator</button>
                        <button onclick="switchView('preview')" id="nav-preview" class="text-slate-400 font-bold pb-1 text-xs md:text-sm">Preview</button>
                        <button onclick="switchView('sql')" id="nav-sql" class="text-slate-400 font-bold pb-1 text-xs md:text-sm">SQL Editor</button>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <button onclick="toggleTheme()" class="w-10 h-10 flex items-center justify-center rounded-xl bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 hover:bg-slate-200 transition-all">
                        <i id="theme-icon" class="fa-solid fa-moon"></i>
                    </button>
                    <button onclick="handleLogout()" class="text-slate-500 font-bold flex items-center gap-2 hover:text-red-500 px-4 py-2 text-sm">
                        <i class="fa-solid fa-power-off"></i> <span class="hidden md:inline">Logout</span>
                    </button>
                </div>
            </div>
        </nav>

        <main class="container mx-auto px-4 py-8 max-w-7xl">
            
            <!-- RSVP VIEW -->
            <div id="rsvp-view">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                    <div class="bg-white dark:bg-slate-800 p-5 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700">
                        <p class="text-slate-400 text-[10px] font-bold uppercase mb-1">Total RSVP</p>
                        <h3 id="stat-total" class="text-2xl font-bold">0</h3>
                    </div>
                    <div class="bg-white dark:bg-slate-800 p-5 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700">
                        <p class="text-blue-500 text-[10px] font-bold uppercase mb-1">Hadir</p>
                        <h3 id="stat-hadir" class="text-2xl font-bold">0</h3>
                    </div>
                    <div class="bg-white dark:bg-slate-800 p-5 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700">
                        <p class="text-red-400 text-[10px] font-bold uppercase mb-1">Absen</p>
                        <h3 id="stat-tidak" class="text-2xl font-bold">0</h3>
                    </div>
                    <div class="bg-white dark:bg-slate-800 p-5 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700">
                        <p class="text-green-500 text-[10px] font-bold uppercase mb-1">Pax Datang</p>
                        <h3 id="stat-pax" class="text-2xl font-bold">0</h3>
                    </div>
                </div>

                <div class="bg-white dark:bg-slate-800 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden">
                    <div class="p-6 border-b dark:border-slate-700 flex flex-col md:flex-row justify-between items-center gap-4">
                        <input type="text" id="search-input" oninput="filterTable()" placeholder="Cari nama tamu..." class="w-full md:w-72 px-4 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl outline-none text-sm transition-all">
                        <div class="flex gap-2 w-full md:w-auto">
                            <button onclick="openModal('add')" class="flex-1 md:flex-none bg-blue-600 text-white px-5 py-2.5 rounded-xl text-sm font-bold flex items-center justify-center gap-2">
                                <i class="fa-solid fa-plus"></i> Tambah Tamu
                            </button>
                            <button onclick="fetchData()" class="bg-slate-100 dark:bg-slate-700 p-2.5 rounded-xl text-slate-600 dark:text-slate-300">
                                <i class="fa-solid fa-rotate"></i>
                            </button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse min-w-[800px]">
                            <thead>
                                <tr class="bg-slate-50/50 dark:bg-slate-900/50 text-slate-500 text-[11px] uppercase font-bold tracking-widest">
                                    <th class="px-6 py-5 border-b dark:border-slate-700">Nama Tamu</th>
                                    <th class="px-6 py-5 border-b dark:border-slate-700">Konfirmasi</th>
                                    <th class="px-6 py-5 border-b dark:border-slate-700">Jumlah</th>
                                    <th class="px-6 py-5 border-b dark:border-slate-700">Pesan</th>
                                    <th class="px-6 py-5 border-b dark:border-slate-700 text-center">Tindakan</th>
                                </tr>
                            </thead>
                            <tbody id="guest-table-body" class="divide-y divide-slate-50 dark:divide-slate-700 text-sm"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- SETTINGS VIEW -->
            <div id="settings-view" class="max-w-4xl mx-auto">
                <div class="bg-white dark:bg-slate-800 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 p-8 transition-colors">
                    <div class="flex items-center gap-3 mb-8">
                        <i class="fa-solid fa-gear text-blue-600 text-xl"></i>
                        <h3 class="font-bold text-lg">Pengaturan Data Undangan</h3>
                    </div>
                    
                    <form id="settings-form" class="space-y-8">
                        <!-- Mempelai Wanita -->
                        <div class="bg-slate-50 dark:bg-slate-900/50 p-6 rounded-2xl border border-slate-100 dark:border-slate-700">
                            <h4 class="font-bold text-blue-900 dark:text-blue-400 mb-4 flex items-center gap-2"><i class="fa-solid fa-venus"></i> Mempelai Wanita</h4>
                            <div class="grid md:grid-cols-2 gap-6 mb-4">
                                <div>
                                    <label class="block text-[11px] font-bold text-slate-500 uppercase mb-2">Nama Lengkap</label>
                                    <input type="text" id="set-bride" required class="w-full px-4 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl outline-none">
                                </div>
                                <div>
                                    <label class="block text-[11px] font-bold text-slate-500 uppercase mb-2">Orang Tua</label>
                                    <input type="text" id="set-bride-parents" required class="w-full px-4 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl outline-none">
                                </div>
                            </div>
                            <div class="mb-4">
                                <label class="block text-[11px] font-bold text-slate-500 uppercase mb-2">Foto Mempelai Wanita (URL)</label>
                                <input type="text" id="set-bride-img" placeholder="https://link-gambar.jpg" class="w-full px-4 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl outline-none">
                            </div>
                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-[11px] font-bold text-slate-500 uppercase mb-2">Bank Mempelai Wanita</label>
                                    <div class="relative">
                                        <button type="button" onclick="toggleBankList('bride')" id="btn-bride-bank" class="w-full px-4 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl outline-none flex items-center justify-between">
                                            <span id="label-bride-bank">Pilih Bank</span>
                                            <i class="fa-solid fa-chevron-down text-xs text-slate-400"></i>
                                        </button>
                                        <input type="hidden" id="set-bride-bank">
                                        <div id="list-bride-bank" class="bank-dropdown-list bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl shadow-xl">
                                            <!-- Items generated by JS -->
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-[11px] font-bold text-slate-500 uppercase mb-2">No. Rekening</label>
                                    <input type="text" id="set-bride-acc" placeholder="Nomor Rekening" class="w-full px-4 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl outline-none">
                                </div>
                            </div>
                        </div>

                        <!-- Mempelai Pria -->
                        <div class="bg-slate-50 dark:bg-slate-900/50 p-6 rounded-2xl border border-slate-100 dark:border-slate-700">
                            <h4 class="font-bold text-blue-900 dark:text-blue-400 mb-4 flex items-center gap-2"><i class="fa-solid fa-mars"></i> Mempelai Pria</h4>
                            <div class="grid md:grid-cols-2 gap-6 mb-4">
                                <div>
                                    <label class="block text-[11px] font-bold text-slate-500 uppercase mb-2">Nama Lengkap</label>
                                    <input type="text" id="set-groom" required class="w-full px-4 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl outline-none">
                                </div>
                                <div>
                                    <label class="block text-[11px] font-bold text-slate-500 uppercase mb-2">Orang Tua</label>
                                    <input type="text" id="set-groom-parents" required class="w-full px-4 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl outline-none">
                                </div>
                            </div>
                            <div class="mb-4">
                                <label class="block text-[11px] font-bold text-slate-500 uppercase mb-2">Foto Mempelai Pria (URL)</label>
                                <input type="text" id="set-groom-img" placeholder="https://link-gambar.jpg" class="w-full px-4 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl outline-none">
                            </div>
                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-[11px] font-bold text-slate-500 uppercase mb-2">Bank Mempelai Pria</label>
                                    <div class="relative">
                                        <button type="button" onclick="toggleBankList('groom')" id="btn-groom-bank" class="w-full px-4 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl outline-none flex items-center justify-between">
                                            <span id="label-groom-bank">Pilih Bank</span>
                                            <i class="fa-solid fa-chevron-down text-xs text-slate-400"></i>
                                        </button>
                                        <input type="hidden" id="set-groom-bank">
                                        <div id="list-groom-bank" class="bank-dropdown-list bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl shadow-xl">
                                            <!-- Items generated by JS -->
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-[11px] font-bold text-slate-500 uppercase mb-2">No. Rekening</label>
                                    <input type="text" id="set-groom-acc" placeholder="Nomor Rekening" class="w-full px-4 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl outline-none">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Waktu & Lokasi -->
                        <div class="bg-slate-50 dark:bg-slate-900/50 p-6 rounded-2xl border border-slate-100 dark:border-slate-700">
                            <h4 class="font-bold mb-4 flex items-center gap-2"><i class="fa-solid fa-calendar-day"></i> Waktu & Lokasi</h4>
                            <div class="grid md:grid-cols-2 gap-6 mb-6">
                                <div>
                                    <label class="block text-[11px] font-bold text-slate-500 uppercase mb-2">Tanggal & Waktu</label>
                                    <input type="datetime-local" id="set-date" required class="w-full px-4 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl outline-none">
                                </div>
                                <div>
                                    <label class="block text-[11px] font-bold text-slate-500 uppercase mb-2">Nama Lokasi</label>
                                    <input type="text" id="set-loc-name" required class="w-full px-4 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl outline-none">
                                </div>
                            </div>
                            <div class="mb-6">
                                <label class="block text-[11px] font-bold text-slate-500 uppercase mb-2">Link Google Maps</label>
                                <input type="text" id="set-maps-url" required class="w-full px-4 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl outline-none" placeholder="https://maps.google.com/...">
                            </div>
                            <div>
                                <label class="block text-[11px] font-bold text-slate-500 uppercase mb-2">Alamat Lengkap</label>
                                <textarea id="set-loc-address" rows="3" required class="w-full px-4 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl outline-none resize-none"></textarea>
                            </div>
                        </div>

                        <!-- Media & Galeri -->
                        <div class="bg-slate-50 dark:bg-slate-900/50 p-6 rounded-2xl border border-slate-100 dark:border-slate-700">
                            <h4 class="font-bold mb-4 flex items-center gap-2"><i class="fa-solid fa-photo-film"></i> Media & Galeri</h4>
                            <div class="mb-6">
                                <label class="block text-[11px] font-bold text-slate-500 uppercase mb-2">Musik Latar (URL Audio)</label>
                                <input type="text" id="set-music" placeholder="https://link-audio.mp3" class="w-full px-4 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl outline-none">
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-[11px] font-bold text-slate-500 uppercase mb-2">Galeri Foto 1 (URL)</label>
                                    <input type="text" id="set-gal-1" class="w-full px-3 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl outline-none text-xs">
                                </div>
                                <div>
                                    <label class="block text-[11px] font-bold text-slate-500 uppercase mb-2">Galeri Foto 2 (URL)</label>
                                    <input type="text" id="set-gal-2" class="w-full px-3 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl outline-none text-xs">
                                </div>
                                <div>
                                    <label class="block text-[11px] font-bold text-slate-500 uppercase mb-2">Galeri Foto 3 (URL)</label>
                                    <input type="text" id="set-gal-3" class="w-full px-3 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl outline-none text-xs">
                                </div>
                                <div>
                                    <label class="block text-[11px] font-bold text-slate-500 uppercase mb-2">Galeri Foto 4 (URL)</label>
                                    <input type="text" id="set-gal-4" class="w-full px-3 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl outline-none text-xs">
                                </div>
                                <div>
                                    <label class="block text-[11px] font-bold text-slate-500 uppercase mb-2">Galeri Foto 5 (URL)</label>
                                    <input type="text" id="set-gal-5" class="w-full px-3 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl outline-none text-xs">
                                </div>
                                <div>
                                    <label class="block text-[11px] font-bold text-slate-500 uppercase mb-2">Galeri Foto 6 (URL)</label>
                                    <input type="text" id="set-gal-6" class="w-full px-3 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl outline-none text-xs">
                                </div>
                            </div>
                        </div>

                        <button type="submit" id="save-settings-btn" class="w-full bg-slate-900 dark:bg-blue-600 text-white py-5 rounded-2xl font-bold shadow-lg hover:opacity-90 transition-all">
                            <i class="fa-solid fa-floppy-disk mr-2"></i> Simpan Perubahan
                        </button>
                    </form>
                </div>
            </div>

            <!-- GENERATOR VIEW -->
            <div id="generator-view" class="max-w-2xl mx-auto">
                <div class="bg-white dark:bg-slate-800 rounded-3 shadow-sm border border-slate-100 dark:border-slate-700 p-8 transition-colors">
                    <div class="flex items-center gap-3 mb-8">
                        <i class="fa-solid fa-paper-plane text-blue-600 text-xl"></i>
                        <h3 class="font-bold text-lg">Invitation Generator</h3>
                    </div>
                    <div class="space-y-6">
                        <div>
                            <label class="block text-[11px] font-bold text-slate-500 uppercase mb-2">URL Undangan</label>
                            <input type="text" id="gen-baseUrl" class="w-full px-4 py-3 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-2xl outline-none" value="https://ade-ami.github.io" oninput="updateGenPreview()">
                        </div>
                        <div>
                            <label class="block text-[11px] font-bold text-slate-500 uppercase mb-2">Nama Tamu</label>
                            <input type="text" id="gen-guestName" class="w-full px-4 py-3 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-2xl outline-none" placeholder="Contoh: Bpk. Jajang & Kel" oninput="updateGenPreview()">
                        </div>
                        <div>
                            <label class="block text-[11px] font-bold text-slate-500 uppercase mb-2">Preview WhatsApp</label>
                            <div class="wa-preview-container p-6 rounded-2xl border dark:border-slate-700">
                                <div id="gen-messagePreview" class="wa-chat-bubble"></div>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <button onclick="copyGenMessage()" class="bg-slate-900 dark:bg-slate-700 text-white py-4 rounded-2xl font-bold flex items-center justify-center gap-2">Salin Teks</button>
                            <button onclick="sendGenWA()" class="bg-green-600 text-white py-4 rounded-2xl font-bold flex items-center justify-center gap-2">Kirim ke WA</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- WEB PREVIEW VIEW -->
            <div id="preview-view" class="max-w-5xl mx-auto">
                <div class="bg-white dark:bg-slate-800 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 p-8 transition-colors">
                    <div class="flex items-center justify-between mb-8">
                        <div class="flex items-center gap-3">
                            <i class="fa-solid fa-desktop text-blue-600 text-xl"></i>
                            <h3 class="font-bold text-lg">Live Web Preview</h3>
                        </div>
                        <div class="flex gap-2 bg-slate-100 dark:bg-slate-700 p-1 rounded-xl">
                            <button onclick="setPreviewSize('mobile')" id="btn-size-mobile" class="px-4 py-2 rounded-lg text-xs font-bold bg-white dark:bg-slate-600 shadow-sm transition-all">Mobile</button>
                            <button onclick="setPreviewSize('desktop')" id="btn-size-desktop" class="px-4 py-2 rounded-lg text-xs font-bold text-slate-400 hover:text-slate-600 transition-all">Desktop</button>
                        </div>
                    </div>
                    
                    <div class="flex flex-col items-center">
                        <div id="preview-container" class="phone-frame border-slate-200 dark:border-slate-700 transition-all duration-500">
                            <iframe id="web-preview-iframe" src="about:blank" class="w-full h-full border-none"></iframe>
                        </div>
                        <p class="mt-6 text-xs text-slate-400 italic">Preview dimuat berdasarkan URL di tab Generator</p>
                    </div>
                </div>
            </div>

            <!-- SQL EDITOR VIEW -->
            <div id="sql-view" class="max-w-5xl mx-auto">
                <div class="bg-white dark:bg-slate-800 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 p-8 transition-colors">
                    <div class="flex items-center gap-3 mb-6">
                        <i class="fa-solid fa-code text-blue-600 text-xl"></i>
                        <h3 class="font-bold text-lg">SQL Editor / Console</h3>
                    </div>
                    <div class="mb-4 space-y-2">
                        <p class="text-xs text-slate-400 bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl">
                            <b>Instruksi Database:</b> Supabase JS tidak mendukung eksekusi SQL mentah secara langsung. Gunakan query di bawah ini pada Dashboard Supabase (Menu SQL Editor) untuk mengupdate struktur tabel Anda.
                        </p>
                        <div class="flex flex-wrap gap-2">
                            <button onclick="fillSQL('guestbook')" class="px-3 py-1 bg-slate-100 dark:bg-slate-700 rounded-lg text-[10px] font-bold hover:bg-blue-100 dark:hover:bg-blue-900 transition-colors uppercase">Query Tambah Guestbook</button>
                            <button onclick="fillSQL('settings')" class="px-3 py-1 bg-slate-100 dark:bg-slate-700 rounded-lg text-[10px] font-bold hover:bg-blue-100 dark:hover:bg-blue-900 transition-colors uppercase">Query Tambah Settings</button>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <textarea id="sql-input" rows="12" class="w-full p-4 font-mono text-sm bg-slate-900 text-green-400 rounded-2xl border border-slate-700 outline-none focus:ring-2 focus:ring-blue-500" placeholder="-- Tulis query Anda di sini..."></textarea>
                        <div class="flex justify-between items-center">
                            <div class="text-xs font-bold text-slate-500">Hasil Console:</div>
                            <button onclick="runSQL()" class="bg-blue-600 text-white px-6 py-2 rounded-xl font-bold text-sm shadow-md hover:bg-blue-700 transition-all">Run Query (Simulasi)</button>
                        </div>
                        <div id="sql-output" class="w-full min-h-[150px] p-4 font-mono text-xs bg-black text-slate-300 rounded-2xl overflow-auto border border-slate-800">
                            > Siap menerima perintah...
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- CRUD MODAL -->
    <div id="crud-modal" class="fixed inset-0 bg-slate-900/60 hidden z-[100] flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white dark:bg-slate-800 w-full max-w-lg rounded-[2.5rem] p-8 shadow-2xl">
            <h3 id="modal-title" class="text-xl font-bold mb-6 text-center">Form Tamu</h3>
            <form id="crud-form" class="space-y-5">
                <input type="hidden" id="entry-id">
                <div>
                    <label class="block text-[11px] font-bold text-slate-500 uppercase mb-2">Nama Lengkap</label>
                    <input type="text" id="field-nama" required class="w-full px-4 py-3 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-2xl outline-none">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-[11px] font-bold text-slate-500 uppercase mb-2">Konfirmasi</label>
                        <select id="field-status" class="w-full px-4 py-3 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-2xl outline-none">
                            <option value="Hadir">Hadir</option>
                            <option value="Tidak Hadir">Tidak Hadir</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-[11px] font-bold text-slate-500 uppercase mb-2">Jumlah Pax</label>
                        <input type="number" id="field-jumlah" min="1" required class="w-full px-4 py-3 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-2xl outline-none">
                    </div>
                </div>
                <div>
                    <label class="block text-[11px] font-bold text-slate-500 uppercase mb-2">Ucapan Doa</label>
                    <textarea id="field-ucapan" rows="3" class="w-full px-4 py-3 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-2xl outline-none resize-none"></textarea>
                </div>
                <div class="flex gap-3 pt-4">
                    <button type="button" onclick="closeModal()" class="flex-1 py-4 bg-slate-100 dark:bg-slate-700 rounded-2xl font-bold text-slate-500">Batal</button>
                    <button type="submit" class="flex-1 py-4 bg-blue-600 rounded-2xl font-bold text-white">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const supabaseUrl = 'https://qczzjtraivdxdergbxjy.supabase.co';
        const supabaseKey = 'sb_publishable_sdf_MeOzRGvsGACogsDBLg_sDMgZOeW';
        const _supabase = supabase.createClient(supabaseUrl, supabaseKey);

        const authSection = document.getElementById('auth-section');
        const adminSection = document.getElementById('admin-section');
        const rsvpView = document.getElementById('rsvp-view');
        const settingsView = document.getElementById('settings-view');
        const generatorView = document.getElementById('generator-view');
        const previewView = document.getElementById('preview-view');
        const sqlView = document.getElementById('sql-view');
        const guestTableBody = document.getElementById('guest-table-body');
        const loginForm = document.getElementById('login-form');
        const mainNav = document.getElementById('main-nav');
        
        let rawData = [];
        let currentBride = "Amy";
        let currentGroom = "Ade";
        let lastScrollY = window.scrollY;

        const BANK_LIST = [
            { name: 'BCA', logo: 'https://upload.wikimedia.org/wikipedia/commons/5/5c/Bank_Central_Asia.svg' },
            { name: 'Mandiri', logo: 'https://upload.wikimedia.org/wikipedia/commons/a/ad/Bank_Mandiri_logo_2016.svg' },
            { name: 'BNI', logo: 'https://upload.wikimedia.org/wikipedia/id/5/55/BNI_logo.svg' },
            { name: 'BRI', logo: 'https://upload.wikimedia.org/wikipedia/commons/2/2e/BRI_Logo.svg' },
            { name: 'BSI', logo: 'https://upload.wikimedia.org/wikipedia/id/a/a0/Bank_Syariah_Indonesia.svg' },
            { name: 'QRIS', logo: 'https://upload.wikimedia.org/wikipedia/commons/a/a2/Logo_QRIS.svg' },
            { name: 'DANA', logo: 'https://upload.wikimedia.org/wikipedia/commons/7/72/Logo_dana_blue.svg' },
            { name: 'OVO', logo: 'https://upload.wikimedia.org/wikipedia/commons/e/eb/Logo_ovo_purple.svg' }
        ];

        // --- SCROLL AUTO-HIDE LOGIC ---
        window.addEventListener('scroll', () => {
            if (authSection.style.display === 'flex') return;
            
            if (window.scrollY > lastScrollY && window.scrollY > 100) {
                mainNav.classList.add('nav-hidden');
            } else {
                mainNav.classList.remove('nav-hidden');
            }
            lastScrollY = window.scrollY;
        });

        function initTheme() {
            if (localStorage.getItem('admin-theme') === 'dark') {
                document.documentElement.classList.add('dark');
                document.getElementById('theme-icon').className = 'fa-solid fa-sun';
            }
        }

        window.toggleTheme = () => {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('admin-theme', isDark ? 'dark' : 'light');
            document.getElementById('theme-icon').className = isDark ? 'fa-solid fa-sun' : 'fa-solid fa-moon';
        };

        window.switchView = (view) => {
            const views = { rsvp: rsvpView, settings: settingsView, generator: generatorView, preview: previewView, sql: sqlView };
            Object.keys(views).forEach(v => views[v].style.display = 'none');
            ['rsvp', 'settings', 'generator', 'preview', 'sql'].forEach(v => {
                const nav = document.getElementById(`nav-${v}`);
                if(nav) nav.className = "text-slate-400 font-bold pb-1 text-xs md:text-sm";
            });
            
            views[view].style.display = 'block';
            document.getElementById(`nav-${view}`).className = "tab-active font-bold pb-1 text-xs md:text-sm";
            
            if (view === 'rsvp') fetchData();
            if (view === 'settings') {
                fetchSettings();
                initBankDropdowns();
            }
            if (view === 'generator') updateGenPreview();
            if (view === 'preview') updatePreviewFrame();
        };

        window.updatePreviewFrame = () => {
            const baseUrl = document.getElementById('gen-baseUrl').value.trim();
            const guestInput = document.getElementById('gen-guestName').value.trim();
            const finalUrl = guestInput ? `${baseUrl}?to=${encodeURIComponent(guestInput)}` : baseUrl;
            const iframe = document.getElementById('web-preview-iframe');
            if(iframe.src !== finalUrl) iframe.src = finalUrl;
        };

        window.setPreviewSize = (size) => {
            const container = document.getElementById('preview-container');
            const btnMobile = document.getElementById('btn-size-mobile');
            const btnDesktop = document.getElementById('btn-size-desktop');

            if(size === 'mobile') {
                container.style.width = '360px';
                container.style.height = '640px';
                container.style.borderWidth = '12px';
                container.style.borderRadius = '32px';
                btnMobile.className = "px-4 py-2 rounded-lg text-xs font-bold bg-white dark:bg-slate-600 shadow-sm transition-all";
                btnDesktop.className = "px-4 py-2 rounded-lg text-xs font-bold text-slate-400 hover:text-slate-600 transition-all";
            } else {
                container.style.width = '100%';
                container.style.height = '640px';
                container.style.borderWidth = '1px';
                container.style.borderRadius = '16px';
                btnDesktop.className = "px-4 py-2 rounded-lg text-xs font-bold bg-white dark:bg-slate-600 shadow-sm transition-all";
                btnMobile.className = "px-4 py-2 rounded-lg text-xs font-bold text-slate-400 hover:text-slate-600 transition-all";
            }
        };

        function initBankDropdowns() {
            renderBankOptions('bride');
            renderBankOptions('groom');
            
            window.addEventListener('click', (e) => {
                if (!e.target.closest('#btn-bride-bank') && !e.target.closest('#list-bride-bank')) {
                    const list = document.getElementById('list-bride-bank');
                    if(list) list.classList.remove('show');
                }
                if (!e.target.closest('#btn-groom-bank') && !e.target.closest('#list-groom-bank')) {
                    const list = document.getElementById('list-groom-bank');
                    if(list) list.classList.remove('show');
                }
            });
        }

        function renderBankOptions(type) {
            const container = document.getElementById(`list-${type}-bank`);
            if(!container) return;
            container.innerHTML = BANK_LIST.map(bank => `
                <div onclick="selectBank('${type}', '${bank.name}', '${bank.logo}')" class="flex items-center gap-3 p-3 hover:bg-slate-50 dark:hover:bg-slate-700 cursor-pointer transition-colors">
                    <img src="${bank.logo}" alt="${bank.name}" class="h-4 w-auto object-contain grayscale group-hover:grayscale-0">
                    <span class="text-xs font-semibold">${bank.name}</span>
                </div>
            `).join('');
        }

        window.toggleBankList = (type) => {
            document.getElementById(`list-${type}-bank`).classList.toggle('show');
        };

        window.selectBank = (type, name, logo) => {
            document.getElementById(`set-${type}-bank`).value = name;
            document.getElementById(`label-${type}-bank`).innerHTML = `
                <div class="flex items-center gap-2">
                    <img src="${logo}" class="h-4 w-auto object-contain">
                    <span class="text-xs font-bold">${name}</span>
                </div>
            `;
            document.getElementById(`list-${type}-bank`).classList.remove('show');
        };

        async function checkSession() {
            const { data: { session } } = await _supabase.auth.getSession();
            if (session) showAdmin(); else showLogin();
        }

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const btn = document.getElementById('login-btn');
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Memverifikasi...';
            btn.disabled = true;

            const { error } = await _supabase.auth.signInWithPassword({ email, password });
            if (error) { 
                alert(error.message); 
                btn.innerText = 'Masuk Sekarang';
                btn.disabled = false;
            } else {
                showAdmin();
            }
        });

        async function handleLogout() { await _supabase.auth.signOut(); showLogin(); }
        function showLogin() { authSection.style.display = 'flex'; adminSection.style.display = 'none'; }
        function showAdmin() { authSection.style.display = 'none'; adminSection.style.display = 'block'; fetchData(); fetchSettings(); }

        async function fetchData() {
            const { data, error } = await _supabase.from('guestbook').select('*').order('created_at', { ascending: false });
            if (!error) { rawData = data; renderStats(data); renderTable(data); }
        }

        function renderStats(data) {
            document.getElementById('stat-total').innerText = data.length;
            document.getElementById('stat-hadir').innerText = data.filter(d => d.Status === 'Hadir').length;
            document.getElementById('stat-tidak').innerText = data.filter(d => d.Status === 'Tidak Hadir').length;
            document.getElementById('stat-pax').innerText = data.reduce((a, b) => a + (parseInt(b.Jumlah) || 0), 0);
        }

        function renderTable(data) {
            guestTableBody.innerHTML = '';
            data.forEach(item => {
                const row = document.createElement('tr');
                row.className = "hover:bg-slate-50 dark:hover:bg-slate-900/50 border-b dark:border-slate-700 transition-all";
                row.innerHTML = `
                    <td class="px-6 py-4 font-bold">${item.Nama}</td>
                    <td class="px-6 py-4"><span class="px-3 py-1 rounded-full text-[10px] font-bold uppercase ${item.Status === 'Hadir' ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'}">${item.Status}</span></td>
                    <td class="px-6 py-4">${item.Jumlah} Pax</td>
                    <td class="px-6 py-4 text-xs max-w-xs truncate">${item.Ucapan || '-'}</td>
                    <td class="px-6 py-4 text-center">
                        <button onclick='openModal("edit", ${JSON.stringify(item)})' class="p-2 text-blue-500"><i class="fa-solid fa-pen"></i></button>
                        <button onclick="deleteEntry('${item.id}')" class="p-2 text-red-400"><i class="fa-solid fa-trash"></i></button>
                    </td>
                `;
                guestTableBody.appendChild(row);
            });
        }

        async function fetchSettings() {
            const { data, error } = await _supabase.from('settings').select('*').eq('id', 1).single();
            if (!error) {
                document.getElementById('set-bride').value = data.bride_name || '';
                document.getElementById('set-bride-parents').value = data.bride_parents || '';
                document.getElementById('set-bride-img').value = data.bride_image || '';
                document.getElementById('set-groom').value = data.groom_name || '';
                document.getElementById('set-groom-parents').value = data.groom_parents || '';
                document.getElementById('set-groom-img').value = data.groom_image || '';
                document.getElementById('set-loc-name').value = data.location_name || '';
                document.getElementById('set-loc-address').value = data.location_address || '';
                document.getElementById('set-maps-url').value = data.maps_url || '';
                
                ['bride', 'groom'].forEach(type => {
                    const bankName = data[`${type}_bank_name`];
                    document.getElementById(`set-${type}-bank`).value = bankName || '';
                    if (bankName) {
                        const bankObj = BANK_LIST.find(b => b.name === bankName);
                        if(bankObj) {
                            document.getElementById(`label-${type}-bank`).innerHTML = `
                                <div class="flex items-center gap-2">
                                    <img src="${bankObj.logo}" class="h-4 w-auto object-contain">
                                    <span class="text-xs font-bold">${bankName}</span>
                                </div>
                            `;
                        }
                    }
                });

                document.getElementById('set-bride-acc').value = data.bride_bank_acc || '';
                document.getElementById('set-groom-acc').value = data.groom_bank_acc || '';
                
                document.getElementById('set-music').value = data.bg_music || '';
                for(let i=1; i<=6; i++) {
                    document.getElementById(`set-gal-${i}`).value = data[`gallery_${i}`] || '';
                }

                currentBride = data.bride_name;
                currentGroom = data.groom_name;
                if(data.wedding_date) document.getElementById('set-date').value = new Date(data.wedding_date).toISOString().slice(0, 16);
            }
        }

        document.getElementById('settings-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('save-settings-btn');
            btn.disabled = true;
            btn.innerText = 'Menyimpan...';

            const payload = {
                bride_name: document.getElementById('set-bride').value,
                bride_parents: document.getElementById('set-bride-parents').value,
                bride_image: document.getElementById('set-bride-img').value,
                groom_name: document.getElementById('set-groom').value,
                groom_parents: document.getElementById('set-groom-parents').value,
                groom_image: document.getElementById('set-groom-img').value,
                wedding_date: document.getElementById('set-date').value,
                location_name: document.getElementById('set-loc-name').value,
                location_address: document.getElementById('set-loc-address').value,
                maps_url: document.getElementById('set-maps-url').value,
                bride_bank_name: document.getElementById('set-bride-bank').value,
                bride_bank_acc: document.getElementById('set-bride-acc').value,
                groom_bank_name: document.getElementById('set-groom-bank').value,
                groom_bank_acc: document.getElementById('set-groom-acc').value,
                bg_music: document.getElementById('set-music').value,
                gallery_1: document.getElementById('set-gal-1').value,
                gallery_2: document.getElementById('set-gal-2').value,
                gallery_3: document.getElementById('set-gal-3').value,
                gallery_4: document.getElementById('set-gal-4').value,
                gallery_5: document.getElementById('set-gal-5').value,
                gallery_6: document.getElementById('set-gal-6').value
            };

            const { error } = await _supabase.from('settings').update(payload).eq('id', 1);
            alert(error ? error.message : "Berhasil diupdate!");
            btn.disabled = false; btn.innerHTML = '<i class="fa-solid fa-floppy-disk mr-2"></i> Simpan Perubahan';
            fetchSettings();
        });

        window.updateGenPreview = () => {
            const baseUrl = document.getElementById('gen-baseUrl').value.trim();
            const guestInput = document.getElementById('gen-guestName').value.trim();
            const guestName = guestInput || "[Nama Tamu]";
            const finalUrl = guestInput ? `${baseUrl}?to=${encodeURIComponent(guestInput)}` : baseUrl;
            const msg = `Assalamu'alaikum Warahmatullahi Wabarakatuh.\n\nTanpa mengurangi rasa hormat, kami mengundang *${guestName}* untuk hadir dalam acara pernikahan kami.\n\nLink Undangan:\n${finalUrl}\n\nTerima kasih.\n*${currentBride} & ${currentGroom}*`;
            document.getElementById('gen-messagePreview').innerText = msg;
            return msg;
        }

        window.copyGenMessage = () => {
            navigator.clipboard.writeText(updateGenPreview());
            alert("Disalin!");
        }

        window.sendGenWA = () => {
            window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(updateGenPreview())}`, '_blank');
        }

        window.fillSQL = (type) => {
            const input = document.getElementById('sql-input');
            if(type === 'guestbook') {
                input.value = `-- Buat tabel guestbook\ncreate table guestbook (\n  id bigint primary key generated always as identity,\n  "Nama" text not null,\n  "Jumlah" int4 not null default 1,\n  "Status" text not null,\n  "Ucapan" text not null,\n  created_at timestamp with time zone default now()\n);\n\n-- Aktifkan Row Level Security (RLS)\nalter table guestbook enable row level security;`;
            } else if(type === 'settings') {
                input.value = `-- 1. Buat tabel settings jika belum ada\nCREATE TABLE IF NOT EXISTS public.settings (\n  id integer NOT NULL DEFAULT 1,\n  bride_name text,\n  bride_image text,\n  groom_name text,\n  groom_image text,\n  wedding_date timestamp with time zone,\n  location_name text,\n  location_address text,\n  bride_parents text,\n  groom_parents text,\n  maps_url text,\n  bride_bank_name text,\n  bride_bank_acc text,\n  groom_bank_name text,\n  groom_bank_acc text,\n  bg_music text,\n  gallery_1 text,\n  gallery_2 text,\n  gallery_3 text,\n  gallery_4 text,\n  gallery_5 text,\n  gallery_6 text,\n  CONSTRAINT settings_pkey PRIMARY KEY (id)\n);\n\n-- 2. Jalankan ALTER untuk memastikan kolom baru ada (jika tabel sudah ada sebelumnya)\nALTER TABLE public.settings \nADD COLUMN IF NOT EXISTS bride_image text,\nADD COLUMN IF NOT EXISTS groom_image text,\nADD COLUMN IF NOT EXISTS bg_music text,\nADD COLUMN IF NOT EXISTS gallery_1 text,\nADD COLUMN IF NOT EXISTS gallery_2 text,\nADD COLUMN IF NOT EXISTS gallery_3 text,\nADD COLUMN IF NOT EXISTS gallery_4 text,\nADD COLUMN IF NOT EXISTS gallery_5 text,\nADD COLUMN IF NOT EXISTS gallery_6 text;\n\n-- 3. Masukkan data awal (default)\nINSERT INTO public.settings (id) VALUES (1) ON CONFLICT DO NOTHING;`;
            }
        }

        window.runSQL = async () => {
            const input = document.getElementById('sql-input').value.toLowerCase();
            const out = document.getElementById('sql-output');
            out.innerText = "> Executing...\n";
            
            setTimeout(() => {
                if(input.includes("alter table settings")) {
                    out.innerText += `> Success: Perintah ALTER TABLE terdeteksi untuk memperbarui kolom settings.\n> Catatan: Gunakan kode ini di SQL Editor Dashboard Supabase Anda.`;
                } else if(input.includes("create table public.settings") || input.includes("create table settings")) {
                    out.innerText += `> Success: Perintah CREATE TABLE SETTINGS terdeteksi.\n> Catatan: Jalankan query ini di SQL Editor Supabase Dashboard Anda.`;
                } else if(input.includes("create table guestbook")) {
                    out.innerText += `> Success: Perintah CREATE TABLE GUESTBOOK terdeteksi.\n> Catatan: Jalankan query ini di SQL Editor Supabase Dashboard Anda.`;
                } else if(input.includes("select * from guestbook")) {
                    out.innerText += `> Result: Found ${rawData.length} rows in guestbook.\n` + JSON.stringify(rawData.slice(0,2), null, 2);
                } else if(input.includes("select * from settings")) {
                    out.innerText += `> Result: Menampilkan pratinjau data settings...\n[Data tersimpan di memori]`;
                } else {
                    out.innerText += `> Console Simulator: Query dijalankan secara virtual.`;
                }
            }, 500);
        }

        window.openModal = (mode, item = null) => {
            document.getElementById('crud-form').reset();
            document.getElementById('entry-id').value = item ? item.id : '';
            if(item) {
                document.getElementById('field-nama').value = item.Nama;
                document.getElementById('field-status').value = item.Status;
                document.getElementById('field-jumlah').value = item.Jumlah;
                document.getElementById('field-ucapan').value = item.Ucapan;
            }
            document.getElementById('crud-modal').classList.remove('hidden');
        };
        window.closeModal = () => document.getElementById('crud-modal').classList.add('hidden');

        document.getElementById('crud-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('entry-id').value;
            const payload = {
                Nama: document.getElementById('field-nama').value,
                Status: document.getElementById('field-status').value,
                Jumlah: parseInt(document.getElementById('field-jumlah').value),
                Ucapan: document.getElementById('field-ucapan').value
            };
            const res = id ? await _supabase.from('guestbook').update(payload).eq('id', id) : await _supabase.from('guestbook').insert([payload]);
            if (!res.error) { closeModal(); fetchData(); }
        });

        window.deleteEntry = async (id) => { if (confirm('Hapus?')) { await _supabase.from('guestbook').delete().eq('id', id); fetchData(); } };

        initTheme();
        checkSession();
        initBankDropdowns();
    </script>
</body>
</html>
